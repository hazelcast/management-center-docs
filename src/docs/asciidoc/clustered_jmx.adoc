
[[clustered-jmx-via-management-center]]
== Clustered JMX via Management Center

[blue]#Hazelcast IMDG Enterprise#

Clustered JMX via Management Center allows you to
monitor clustered statistics of distributed objects
from a JMX interface.

=== Configuring Clustered JMX

In order to configure Clustered JMX, use the following
command line parameters for your Management Center deployment.

* `-Dhazelcast.mc.jmx.enabled=true` (default is false)
* `-Dhazelcast.mc.jmx.port=9000` (optional, default is 9999)
* `-Dcom.sun.management.jmxremote.ssl=false`
* `-Dhazelcast.mc.jmx.rmi.port=9001` (optional, default is 9998)
* `-Dhazelcast.mc.jmx.host=localhost` (optional, default is server's host name)

With embedded Jetty, you do not need to deploy your
Management Center application to any container or application server.

You can start the Management Center application with
Clustered JMX enabled as shown below.

[subs="attributes"]
```bash
java -Dhazelcast.mc.jmx.enabled=true
-Dhazelcast.mc.jmx.port=9999
-Dcom.sun.management.jmxremote.ssl=false -jar {mc-war-file}
```

Once the Management Center starts, you should see a log
similar to the one below:

```bash
INFO: Management Center 3.3
Jun 05, 2014 11:55:32 AM com.hazelcast.webmonitor.service.jmx.impl.JMXService
INFO: Starting Management Center JMX Service on port :9999
```

You should be able to connect to the Clustered JMX interface
using the address `localhost:9999`.

You can use `jconsole` or any other JMX client to monitor your
Hazelcast IMDG cluster. As an example, below is the `jconsole`
screenshot of the Clustered JMX hierarchy.

image::ClusteredJMX.png[JMX]

==== Enabling TLS/SSL for Clustered JMX

By default, Clustered JMX is served unencrypted. To enable
TLS/SSL for Clustered JMX, use the following command line
parameters for your Management Center deployment:

* `-Dhazelcast.mc.jmx.ssl=true` (default is false)
* `-Dhazelcast.mc.jmx.ssl.keyStore=path to your keystore`
* `-Dhazelcast.mc.jmx.ssl.keyStorePassword=password for your keystore`

The following is an example on how to start the Management Center
with a TLS/SSL enabled Clustered JMX service on port 65432:

[subs="attributes"]
```bash
java -Dhazelcast.mc.jmx.enabled=true \
-Dhazelcast.mc.jmx.port=65432 \
-Dhazelcast.mc.jmx.ssl=true \
-Dhazelcast.mc.jmx.ssl.keyStore=/some/dir/selfsigned.jks \
-Dhazelcast.mc.jmx.ssl.keyStorePassword=yourpassword \
-jar {mc-war-file}
```

NOTE: You can encrypt the keystore password and pass it as a
command line argument in encrypted form for improved security.
See the <<variable-replacers, Variable Replacers section>> for more information.

Then, you can use the following command to connect to the
Clustered JMX service using JConsole with the address `localhost:65432`:

```
jconsole -J-Djavax.net.ssl.trustStore=/some/dir/selftrusted.ts -J-Djavax.net.ssl.trustStorePassword=trustpass
```

===== Enabling TLS Mutual Authentication for Clustered JMX

In order to secure the Clustered JMX interface, you can use
the following command line parameters to enable TLS mutual
authentication:

* `-Dhazelcast.mc.jmx.mutualAuthentication=true` (default is false)
* `-Dhazelcast.mc.jmx.ssl.trustStore=path to your truststore`
* `-Dhazelcast.mc.jmx.ssl.trustStorePassword=password for your truststore`

The following is an example on how to start the Management Center
with a TLS mutual authentication enabled Clustered JMX service on port 65432:

[subs="attributes"]
```bash
java -Dhazelcast.mc.jmx.enabled=true \
-Dhazelcast.mc.jmx.port=65432 \
-Dhazelcast.mc.jmx.ssl=true \
-Dhazelcast.mc.jmx.mutualAuthentication=true \
-Dhazelcast.mc.jmx.ssl.keyStore=/some/dir/selfsigned.jks \
-Dhazelcast.mc.jmx.ssl.keyStorePassword=yourpassword \
-Dhazelcast.mc.jmx.ssl.trustStore=/some/dir/truststore.jks \
-Dhazelcast.mc.jmx.ssl.trustStorePassword=yourpassword \
-jar {mc-jar-file}
```

===== Additional TLS/SSL Configuration Options

The following are some additional command line arguments
that you can use to configure TLS/SSL for clustered JMX:

* `-Dhazelcast.mc.jmx.ssl.keyStoreType`: Type of the keystore. Its default
value is JKS.
* `-Dhazelcast.mc.jmx.ssl.keyManagerAlgorithm`: Name of the algorithm based
on which the authentication keys are provided.
The system default is used if none is provided. You can find out the default by calling
the `javax.net.ssl.KeyManagerFactory#getDefaultAlgorithm` method.

=== Clustered JMX API

The management beans are exposed with the following object name format:

```plain
ManagementCenter[`*cluster name*`]:type=<`*object type*`>,name=<`*object name*`>,member="<`*cluster member IP address*`>"
```

The object name starts with the `ManagementCenter` prefix. Then it has
the cluster name in brackets followed by a colon. After that, `type`,
`name` and `member` attributes follow, each separated with a comma.

* `type` is the type of object. Values are `Clients`, `Executors`,
`Maps`, `Members`, `MultiMaps`, `Queues`, `Counters`, `Services`, and `Topics`.
* `name` is the name of object.
* `member` is the member address of object (only required if the
statistics are local to the member).

A sample bean is shown below.

```plain
ManagementCenter[dev]:type=Services,name=OperationService,member="192.168.2.79:5701"
```

Here is the list of attributes that are exposed from the Clustered JMX interface.

* **ManagementCenter**
* ManagementCenter
  ** LicenseExpirationTime
  ** Clusters
* **ManagementCenter[`<ClusterName>`]**
* `<ClusterName>`
  ** MasterAddress
  ** LicenseExpirationTime
* ClientStats
  ** `<Client UUID>`
    *** HeapUsedMemory
    *** HeapFreeMemory
    *** HeapMaxMemory
    *** HeapTotalMemory
    *** ClientName
    *** AvailableProcessors
    *** Uptime
    *** Enterprise
    *** MemberConnection
    *** ClusterConnectionTimestamp
    *** LastStatisticsCollectionTime
    *** UserExecutorQueueSize
    *** CommittedVirtualMemorySize
    *** FreePhysicalMemorySize
    *** FreeSwapSpaceSize
    *** MaxFileDescriptorCount
    *** OpenFileDescriptorCount
    *** ProcessCpuTime
    *** SystemLoadAverage
    *** TotalPhysicalMemorySize
    *** TotalSwapSpaceSize
    *** Version
    *** Address
    *** Type
    *** CACHE
      **** `<Cache Name>`
        ***** Evictions
        ***** Expirations
        ***** Hits
        ***** Misses
        ***** OwnedEntryCount
        ***** OwnedEntryMemoryCost
        ***** LastPersistenceDuration
        ***** LastPersistenceKeyCount
        ***** LastPersistenceTime
        ***** LastPersistenceWrittenBytes
        ***** LastPersistenceFailure
        ***** CreationTime
    *** MAP
      **** `<Map Name>`
        ***** Evictions
        ***** Expirations
        ***** Hits
        ***** Misses
        ***** OwnedEntryCount
        ***** OwnedEntryMemoryCost
        ***** LastPersistenceDuration
        ***** LastPersistenceKeyCount
        ***** LastPersistenceTime
        ***** LastPersistenceWrittenBytes
        ***** LastPersistenceFailure
        ***** CreationTime
* Clients
  ** `<Client Address>`
   *** Address
   *** CanonicalHostName
   *** ClientName
   *** ClientType
   *** IpAddress
   *** Labels
   *** Uuid
* Executors
  ** `<Executor Name>`
    *** Cluster
    *** Name
    *** StartedTaskCount
    *** CompletedTaskCount
    *** CancelledTaskCount
    *** PendingTaskCount
* Maps
  ** `<Map Name>`
    *** Cluster
    *** Name
    *** BackupEntryCount
    *** BackupEntryMemoryCost
    *** CreationTime
    *** DirtyEntryCount
    *** Events
    *** GetOperationCount
    *** HeapCost
    *** Hits
    *** LastAccessTime
    *** LastUpdateTime
    *** LockedEntryCount
    *** MaxGetLatency
    *** MaxPutLatency
    *** MaxRemoveLatency
    *** OtherOperationCount
    *** OwnedEntryCount
    *** PutOperationCount
    *** RemoveOperationCount
    *** AvgGetLatency
    *** AvgPutLatency
    *** AvgRemoveLatency
* ReplicatedMaps
  ** `<Replicated Map Name>`
    *** Cluster
    *** Name
    *** BackupEntryCount
    *** BackupEntryMemoryCost
    *** CreationTime
    *** DirtyEntryCount
    *** Events
    *** GetOperationCount
    *** HeapCost
    *** Hits
    *** LastAccessTime
    *** LastUpdateTime
    *** LockedEntryCount
    *** MaxGetLatency
    *** MaxPutLatency
    *** MaxRemoveLatency
    *** OtherOperationCount
    *** OwnedEntryCount
    *** PutOperationCount
    *** RemoveOperationCount
    *** AvgGetLatency
    *** AvgPutLatency
    *** AvgRemoveLatency
* Members
  ** `<Member Address>`
    *** Uuid
    *** CpMemberUuid
    *** ConnectedClientCount
    *** HeapFreeMemory
    *** HeapMaxMemory
    *** HeapTotalMemory
    *** HeapUsedMemory
    *** IsMaster
    *** OwnedPartitionCount
* MultiMaps
  ** `<MultiMap Name>`
    *** Cluster
    *** Name
    *** BackupEntryCount
    *** BackupEntryMemoryCost
    *** CreationTime
    *** DirtyEntryCount
    *** Events
    *** GetOperationCount
    *** HeapCost
    *** Hits
    *** LastAccessTime
    *** LastUpdateTime
    *** LockedEntryCount
    *** MaxGetLatency
    *** MaxPutLatency
    *** MaxRemoveLatency
    *** OtherOperationCount
    *** OwnedEntryCount
    *** PutOperationCount
    *** RemoveOperationCount
    *** AvgGetLatency
    *** AvgPutLatency
    *** AvgRemoveLatency
* Queues
  ** `<Queue Name>`
    *** Cluster
    *** Name
    *** MinAge
    *** MaxAge
    *** AvgAge
    *** OwnedItemCount
    *** BackupItemCount
    *** OfferOperationCount
    *** OtherOperationsCount
    *** PollOperationCount
    *** RejectedOfferOperationCount
    *** EmptyPollOperationCount
    *** EventOperationCount
    *** CreationTime
* Counters
  ** `<Counter Name>`
    *** Cluster
    *** Name
    *** ReplicaCount
    *** Time
    *** OpsPerSecInc (for each member)
    *** OpsPerSecDec (for each member)
    *** Value (for each member)
* Services
  ** ConnectionManager
    *** ActiveConnectionCount
    *** ClientConnectionCount
    *** ConnectionCount
  ** EventService
    *** EventQueueCapacity
    *** EventQueueSize
    *** EventThreadCount
  ** OperationService
    *** ExecutedOperationCount
    *** OperationExecutorQueueSize
    *** OperationThreadCount
    *** RemoteOperationCount
    *** ResponseQueueSize
    *** RunningOperationsCount
  ** PartitionService
    *** ActivePartitionCount
    *** PartitionCount
  ** ProxyService
    *** ProxyCount
  ** ManagedExecutor[hz::async]
    *** Name
    *** CompletedTaskCount
    *** MaximumPoolSize
    *** PoolSize
    *** QueueSize
    *** RemainingQueueCapacity
    *** Terminated
  ** ManagedExecutor[hz::client]
    *** Name
    *** CompletedTaskCount
    *** MaximumPoolSize
    *** PoolSize
    *** QueueSize
    *** RemainingQueueCapacity
    *** Terminated
  ** ManagedExecutor[hz::global-operation]
    *** Name
    *** CompletedTaskCount
    *** MaximumPoolSize
    *** PoolSize
    *** QueueSize
    *** RemainingQueueCapacity
    *** Terminated
  ** ManagedExecutor[hz::io]
    *** Name
    *** CompletedTaskCount
    *** MaximumPoolSize
    *** PoolSize
    *** QueueSize
    *** RemainingQueueCapacity
    *** Terminated
  ** ManagedExecutor[hz::query]
    *** Name
    *** CompletedTaskCount
    *** MaximumPoolSize
    *** PoolSize
    *** QueueSize
    *** RemainingQueueCapacity
    *** Terminated
  ** ManagedExecutor[hz::scheduled]
    *** Name
    *** CompletedTaskCount
    *** MaximumPoolSize
    *** PoolSize
    *** QueueSize
    *** RemainingQueueCapacity
    *** Terminated
  ** ManagedExecutor[hz::system]
    *** Name
    *** CompletedTaskCount
    *** MaximumPoolSize
    *** PoolSize
    *** QueueSize
    *** RemainingQueueCapacity
    *** Terminated
* Topics
  ** `<Topic Name>`
    *** Cluster
    *** Name
    *** CreationTime
    *** PublishOperationCount
    *** ReceiveOperationCount
* FlakeIdGenerators
  ** `<Generator Name>`
    *** Cluster
    *** Name
    *** Time
    *** OpsPerSec (per member)
* WanConfigs
  ** `<Wan Replication Config>`
    *** Cluster
    *** Name
    *** TargetGroupSet
    *** getTime(`<Publisher ID>`)
    *** getOutboundQueueSize(`<Publisher ID>`)
    *** getMaxOutboundQueueSize(`<Publisher ID>`)
    *** getTotalPublishedEventCount(`<Publisher ID>`)
    *** getTotalPublishLatency(`<Publisher ID>`)

=== Integrating with New Relic

Use the Clustered JMX interface to integrate the Hazelcast Management Center
with New Relic. To perform this integration, attach the New Relic Java agent
and provide an extension file that describes which metrics will be sent to New Relic.

See http://docs.newrelic.com/docs/java/custom-jmx-instrumentation-by-yml[Custom JMX instrumentation by YAML]
on the New Relic webpage.

The following is an example Map monitoring `.yml` file for New Relic:

[source,plain]
----
name: Clustered JMX
version: 1.0
enabled: true

jmx:
- object_name: ManagementCenter[clustername]:type=Maps,name=mapname
  metrics:
  - attributes: PutOperationCount, GetOperationCount, RemoveOperationCount, Hits, BackupEntryCount, OwnedEntryCount, LastAccessTime, LastUpdateTime
  - type: simple
- object_name: ManagementCenter[clustername]:type=Members,name="member address in double quotes"
  metrics:
  - attributes: OwnedPartitionCount
  - type: simple
----

Put the `.yml` file in the `extensions` directory in your New Relic
installation. If an `extensions` directory does not exist there, create one.

After you set your extension, attach the New Relic Java agent and
start the Management Center as shown below.

[subs="attributes"]
```bash
java -javaagent:/path/to/newrelic.jar -Dhazelcast.mc.jmx.enabled=true\
    -Dhazelcast.mc.jmx.port=9999 -jar {mc-war-file}
```

If your logging level is set to `FINER`, you should see the log listing
in the file `newrelic_agent.log`, which is located in the `logs` directory
in your New Relic installation. The following is an example log listing:

```plain
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINE:
    JMX Service : querying MBeans (1)
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINER:
    JMX Service : MBeans query ManagementCenter[dev]:type=Members,
    name="192.168.2.79:5701", matches 1
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINER:
    Recording JMX metric OwnedPartitionCount : 68
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINER:
    JMX Service : MBeans query ManagementCenter[dev]:type=Maps,name=orders,
    matches 1
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINER:
    Recording JMX metric Hits : 46,593
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINER:
    Recording JMX metric BackupEntryCount : 1,100
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINER:
    Recording JMX metric OwnedEntryCount : 1,100
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINER:
    Recording JMX metric RemoveOperationCount : 0
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINER:
    Recording JMX metric PutOperationCount : 118,962
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINER:
    Recording JMX metric GetOperationCount : 0
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINER:
    Recording JMX metric LastUpdateTime : 1,401,962,426,811
Jun 5, 2014 14:18:43 +0300 [72696 62] com.newrelic.agent.jmx.JmxService FINER:
    Recording JMX metric LastAccessTime : 1,401,962,426,811
```

Then you can navigate to your New Relic account and create Custom Dashboards.
See http://docs.newrelic.com/docs/dashboards-menu/creating-custom-dashboards[Creating custom dashboards].

While you are creating the dashboard, you should see the metrics that
you are sending to New Relic from the Management Center in the **Metrics**
section under the JMX directory.

=== Integrating with AppDynamics

Use the Clustered JMX interface to integrate the Hazelcast Management Center
with *AppDynamics*. To perform this integration, attach the AppDynamics
Java agent to the Management Center.

For agent installation, see the
http://docs.appdynamics.com/display/PRO14S/Install+the+App+Agent+for+Java[Install the App Agent for Java] page.

For monitoring on AppDynamics, see the
http://docs.appdynamics.com/display/PRO14S/Monitor+JMX+MBeans#MonitorJMXMBeans-UsingAppDynamicsforJMXMonitoring[Using AppDynamics for JMX Monitoring] page.

After installing AppDynamics agent, you can start the Management Center as shown below:

[subs="attributes"]
```bash
java -javaagent:/path/to/javaagent.jar -Dhazelcast.mc.jmx.enabled=true\
    -Dhazelcast.mc.jmx.port=9999 -jar {mc-war-file}
```

When the Management Center starts, you should see the logs below:

```plain
Started AppDynamics Java Agent Successfully.
Hazelcast Management Center starting on port 8080 at path : /hazelcast-mancenter
```

